

## Catmull-Clark subdivision
Catmull-Clark 细分在1978 年由Edwin Catmull 和Jim Clark 提出，之后在各种渲染场景中都可以发挥作用，从学术界到游戏再到动画电影都有其身影，也因此获得了2006 年奥斯卡技术成就奖。

Catmull-Clark 算法每一次细分由增设面点（face point）、增设边点（edge point）、更新顶点(vertex point)、形成新的边和面四个步骤组成，如图8.9所示，下面我们依次介绍．

1. 增设面点：对多面体的每个面片计算一个面点，这个面点是这个多边形面上所有顶点坐标的平均值．
2. 增设边点：对多面体的每条边计算一个边点，找出该条边的两个端点和共享该条边的两个面的面点，对这四个点的坐标取平均．
3. 更新顶点：对于多边形原有的每个顶点v，使用（1）所有包含顶点v 的边的中点(注意不是上述步骤中的边点) 的平均值R，（2）所有包含顶点v 的多边形面片的面点的平均值F,（3）以及顶点v 的原有值的加权平均值来调整其三维坐标．加权平均遵循以下公式：(F + 2R + (n − 3)*v)/n, 其中n 是面点的数量．
4. 形成新的边和面：将每个面点连接到所有构成了它所在的原始面的边的边点，将每个新顶点连接到所有连接着它原始点的边的边点．新的面就由这些边包围而成．

不论原多边形网格是何结构，新得到的多边形网格将只由四边形构成．

## Loop subdivision

Loop 细分是常见的针对三角网格模型的细分方法，由Charles Loop 在1987 年提出．每一次细分将三角面片细分为四个更小的面片，迭代下去使几何表面变得平滑．

Loop 细分的过程由计算新顶点和更新原有顶点两步组成．
1. 计算新顶点：
   1. 对于每一条边，如果这条边被两个三角形面所包含，则由这条边的两个端点v0, v2 和“跨过”这条边的两个顶点v1, v3 加权平均计算出新顶点ep，具体的计算公式为ep =(v0 + v2)*3/8 +(v1 + v3) * 1/8
   2. 如果这条边只被一个三角形面所包含（即为边界上的边），则直接取这条边的中点作为新顶点．
2. 更新原有顶点：对于每个原有顶点v，根据以下公式更新后的位置v′, 
$$
v′ =  (1 − n ∗ u)v +\sum_{i=0}^muV_i
$$   


其中n 为顶点v 的度数，vi 为与v 有边相连的顶点，当n = 3 时$u = \frac3{16}$，否则$u = \frac3{8n}$．通过不断地生成新顶点和更新原有顶点，每一次细分后连接新顶点与原有顶点，三角面片变得更加精细，得到的几何表面更加平滑.


## 网格参数化(Mesh parameterization)

网格参数化(mesh parameterization)，它是将三维和二维联系起来的桥梁,通过二维纹理空间和三维曲面之间的对应关系，计算三维曲面上每一点颜色值．这个过程需要建立三维曲面和二维纹理平面之间的一一映射，也就是参数化的过程，即计算三维空间曲面的每个网格顶点对应的两个纹理空间中坐标值(u, v)．

1. 球极平面投影(Stereographic Projectile)：将一个圆球面通过指定极点射影至一个平面的映射．能够保持角度不变，但是面积会发生改变，尤其在极点附近．
2. 墨卡托投影(Mercator Projectile)：投影后经线是一组竖直的等距离平行直线，纬线是垂直于经线的一组平行直线．各相邻纬线间隔由赤道向两极增大．一点上任何方向的长度比均相等，即没有角度变形，而面积变形显著，随远离标准纬线而增大．该投影具有等角航线被表示成直线的特性，故广泛用于编制航海图和航空图等．
3. 朗伯投影(Lambert Projectile)：一种等面积的平面投影，它不仅可以精确记录面积，也能不改变方向，一般用于绘制精度要求较高的地质图或导航图．这种投影一般不会把整个世界划在同一张图上，因为地图外围的区域形变会比较大（外围会在远离基准点的方向压缩，导致轮廓变得很扁）．它一般只包括某个半球、某个大陆甚至某个区域．


按照参数域的不同, 网格参数化可以分为：
(1) 平面(planar) 参数化，即将网格映射到平面；
(2) 球面(spherical) 参数化，即将网格映射到规则的球面；
(3) 基域(simplicial) 参数化，采用一个同构的简化模型作为参数域；
(4) 以及基于其它参数域的参数化．

按照参数化过程中保持哪种几何量，可以将参数化分为保长度(Isometric) 的参数化、保角度(Conformal) 的参数化、保面积(Equiareal) 的参数化等等，即：将网格曲面映射到平面上时，分别保证长度、角度、面积不发生扭曲．事实上，保长度的映射等价于既保角度又保面积的映射．从三维网格表面映射到平面或其他参数域，理想的参数化是保形参数化，即保持局部形状不发生改变．这里的形状描述包括长度、角度、面积等几何度量．但理论上只有可展曲面(developable surface) 存在保形参数化，如圆柱侧面，而一般的曲面在进行映射时都会发生不同程度的扭曲．

寻找网格表面顶点和平面上点之间的一一对应，又可以分为两种类型的平面参数化：
(1) 开网格参数化，这种情形下网格是具有边界的开网格，又分为固定边界映射和自由边界映射；
(2) 闭网格参数化，这种情形下网格构成一个封闭曲面，通常人为指定一条边界将封闭网格切开，然后转化为开网格进行参数化．


## 弹簧模型 Spring System

开网格的平面参数化中，最基础的模型是`弹簧模型`．网格顶点作为图节点，网格边作为连接节点的边，形成多个弹簧连接的一个整体．建立从网格到纹理空间的参数化映射，也就是将每个网格顶点$s_i = (x_i, y_i, z_i) ∈ R^3$ 映射成二维参数空间中的点$t_i = (u_i, v_i) ∈ R^2$，我们可以采用弹簧系统的能量函数来描述参数化后的系统状态．弹簧的拉伸最后会达到平衡状态，使得整个系统能量最低(导数为0)，这个状态也就是参数化的最终结果．

弹簧能量公式： n表示节点总数，$D_{ij}$表示第i和第j个订单的弹簧的劲度系数，也是其所对应边在系统中的权重。

$$
E = \frac{1}{2}\sum_{i=1}^n\sum_{j∈N_i}\frac{1}{2}D_{ij}||t_i-t_j||^2
$$

求解：

$$
\begin{aligned}
\frac{\partial E}{\partial t_i} = \sum_{j∈N_i}D_{ij}(t_i-t_j)=0 \\
& => \sum_{j∈N_i}D_{ij}t_i = \sum_{j∈N_i}D_{ij}t_j \\
& => t_i = \sum_{j∈N_i}\lambda_{ij}t_j, \lambda_{ij} = \frac{D_{ij}}{\sum_{k∈N_i}D_{ik}}
\end{aligned}
$$

1. 网格每个顶点在参数化后可以表示为相邻顶点的线性组合
2. 组合系数$λ_{ij}$ 是连接该顶点的弹簧系数的加权平均，也被称为仿射组合系数

一种约束条件采用固定边界映射，也称为重心坐标映射方法．将开网格边界上的顶点首先映射到指定的凸多边形边界上，例如正方形，那么这些顶点对应的参数化坐标在方程组中变为已知，从而可以求解内部顶点的参数化后的坐标．


常用的仿射组合系数有三种：
1. 平均系数：$λ_{ij} = \frac1{n_i}$ ，即设置为相邻顶点个数的倒数；
2. 均值坐标系数：$λ_{ij} = (tan \frac{β_{ji}}2 + tan \frac{α_{ij}}2 )/r_{ij}$，式中符号含义见图8.16
3. 调和坐标系数：$λ_{ij} = (cot γ_{ij} + cot γ_{ji})/2$，只和角度有关，近似于保角映射．