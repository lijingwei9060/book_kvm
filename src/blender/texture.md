# intro

UV坐标，纹理坐标，texture coordinate


三角形网格  和 纹理映射过程： 1. 顶点对应UV坐标，表面的点通过重心坐标的插值对应UV，插值使用透视矫正插值法。

UV展开 UV Unwrapping： 
1. 球面UV展开： $u=0.5 + \frac{\arctan2(r_x, r_z)}{2\pi}$, $v=0.5 - \frac{\arcsin(r_y)}{\pi}$, 这种比较简单，但是存在分布不均匀的现象。

往往需要将材质切分成很多个块，不同块的UV并不连续，目标是块内整体比较均匀，这个过程称为UV拆分和UV缝合。

## 纹理坐标插值

在Phong着色中，需要查询每个像素的颜色，也就是提取每个像素的UV坐标然后再纹理图像中查询，可能遇到被查询的点不在像素重心，UV坐标约化到最邻近的像素。为了得到更平滑的结果我们需要在纹理图像中插值UV坐标得到颜色，插值方法是采用双线性插值(Bilinear Interpolation)。类似的插值放啊： 最邻近像素 Nearest、双线性插值Bilinear、双三次插值Bicubic，最邻近插值有明显的锯齿，双三次插值在头发丝等地方更为平滑，在大片区域差别不大。

插值方法：
1. 查询的点位于像素纹理$c_0,c_1,c_2,c_3$ 构成的正方形，s、t代表其相对于左上角的像素正方形的比例，
2. 多第一次竖直方向的插值： $c_{03} = t_{c0} + (1-t)c_3$, $c_{12} = tc_1 + (1-t)c_2$。
3. 然后做水平方向插值: $c=(1-t)(1-s)c_0 + (1-t)sc_1 + (1-s)tc_3 + stc_2$。


## 纹理反走样

摩尔纹 Moire： 
锯齿 Jaggies：

光栅画的走样来源于采样不足，屏幕空间均匀，但是纹理空阿金不均匀，远处一个像素对应较大的纹理区域，颜色应该是一大片区域的平均。

Mipmap算法： 需要对纹理做不同程度的模糊化（多个像素合成一个像素），
理想方法为预计算，制作纹理的时候做不同层次的低通滤波， $1+\frac{1}{4} + \frac{1}{4^2} + ... = \frac{4}{3}$, 多占用33.3%的内存。

屏幕空间到纹理空间的放大比例为x方向和y方向放啊比例的最大值，通过log约化为证书，映射函数为 $Midmap \space Level = \log_2 max(\sqrt{(\frac{du}{dx})^2 + (\frac{dv}{dx})^2}, \sqrt{(\frac{du}{dy})^2+(\frac{dv}{dy})^2})$。


Mipmap算法带来的问题： 远处网格细节丢失，变粗，垂直方向过渡模糊。屏幕像素不是2个方向等比例拉伸，需要进行`各向异性的低通滤波`, 改进版的Mipmap算法称为`各向异性Mipmap(Anisotropic Mipmap)`。除了保存2*2，4*4层次外还需要2*4,4*2这样的模糊存储空间 $(1+\frac{1}{2} + \frac{1}{2^2} + ...)^2 = 4$ 。

椭圆加权平均滤波（EWA 滤波, Elliptical Weighted Average Filtering, EWA Filtering）可以处理不规则的像素拉伸。


## 纹理应用

纹理数据作为uniform数据传入顶点着色器或者偏远着色器，作为输出或者输入。

纹理尚稷路表面的材质信息，比如漫反射颜色、镜面反射颜色、粗糙度等。

记录几何信息：凹凸结构法向贴图 Normal Mapping，也是凹凸贴图 Bump Mapping 。法线是三维空间中向量，可以对应到RGB 颜色的三个分量，因此可以用储存颜色贴图相同的格式储存。位移贴图（Displacement Mapping）会改变物体的几何，它记录的是顶点位置的偏移。一般会配合细分曲面技术一起使用，比如在现代图形管线中存在的几何着色器（Geometry Shader），可以在渲染阶段增加几何表面顶点的个数

记录光影： 环境光贴图 Environment Mapping。光影信息： 明暗， 硬阴影、软阴影。 环境光这笔贴图 Ambient Occlusion Mapping

程序贴图 Procedure Texture： 生成纹理的方法，

阴影贴图： shadow mapping，快速计算光线遮蔽，