# intro

材质 + 光照

shading着色过程就是上材质的过程。

光照： 

1. 平行光 directional light: 方向和强度，方向为一个三维向量，强度为入射光线与接受表面的夹角$\theta$, 强度因子为$cos\theta$, 强度为$I_d$, 最终接收到的强度为$I_dcos\theta$。 
2. 环境光(ambient light): 四面反射过来，间接光源(indirection illumination), 各个方向均匀，光强$I_a$。
3. 点光源(point light): 没有方向，位置P，单位长度处的强度$I_p$，随距离衰减，衰减公式为$1/r^2$, r为距离, r处的光强为$I_p/r^2$.

反射：

1. 漫反射(diffuse reflection): 极度粗糙不平入射光线会被漫反射，发生漫反射的物理称为朗伯体(Lambert body)。漫反射后各个方向的光强相同。观察者看到的光强公式为$L_d = k_d(I_a + I_dmax(0,n\cdot l))$ 。
   1. $k_d$表示漫反射的颜色，反射强度均匀但是反射的频率会因为表面吸收表现不一样，表现为RGB三个分量上的反射系数。
   2. $I_a$和$I_d$为环境光和平行光的强度，存在点光源时需要把平行光(太阳？)$I_d$换成点光源强度$I_p/r^2$, 如果三种光源都存在按我理解是加和各种光源强度。
   3. $n \cdot l$ 就是$cos\theta$, 是光线与发现的夹角，是平行光的强度系数。max来确定是处于法线一侧就被光照，另外一侧就是阴影。

2. 镜面反射(specular reflection): 理想的镜面反射光线的出射角等于入射角。现实中的反射光线分布于理想反射光线附件的圆锥内，中心最强，边缘较弱。观察者与反射光之间有个夹角，这个夹角越大收到的光强越小，越小光强越大。定义半程向量h，半程向量为入射光夹角和观察者夹角的均值。半程向量h与法线之间的夹角为a，这个a可以代表观察者角度和反射角度的偏移，用$cos\alpha$正好可以表达强度系数，所以最终的镜面反射在观察者的强度为$L_s = k_sI_dmax(0, n \cdot h)^p$ 。p表示镜面反射的集中度，p比较小时代表光线比较分散，表面比较粗糙，$cos^p \alpha$ 衰减的比较慢，会趋向漫反射；p比较大时，表示光线集中，表面光滑，$cos^p \alpha $ 衰减比较快，趋向于理想的镜面反射，只有在反射角才能看到反射光线。

3. Blinn-Phong 反射模型，正常的物体反射包含漫反射和镜面反射，最终观察者接收到光照模型是两个反射的和 $L = k_d(I_a + I_dmax(0,n \cdot l )) + k_sI_dmax(0, n \cdot h) ^p$


## 光栅化 raser 深度计算

光线的遮挡影响 像素的深度 如何计算？
透视投影变换是非线性
中心坐标依赖于三角形的面积

透视矫正插值 perspective-correct interpolation： $f=\frac{ \frac{\alpha}{w_a}f_a + \frac{\beta}{w_b}f_b + \frac{\gamma}{w_c}f_c } {\frac{\alpha}{w_a} + \frac{\beta}{w_b} + \frac{\gamma}{w_c}}$, 其中$\alpha， \beta，\gamma$ 是使用屏幕坐标求得的中心坐标，$w_a,w_b,w_c$是透视投影之后得到的齐次坐标系的第四个分量(?),其实就是变换前的深度z。透视矫正下像素深度的插值公式为$\frac{1}{z} = \frac{\alpha}{z_a} + \frac{\beta}{z_b} + \frac{\gamma}{z_c}$, 等价于对$\frac{1}{z}$进行线性插值，和对z进行线性插值区别很大。

网格的颜色： 


背面剔除： Back Face fulling， 封闭几何体背面不会出现，$v \cdot n \gt 0$ 法线与观察者同向，这个三角形就是背面，不需要进行深度缓存和着色。？？？？


## 着色模型

平面着色： Flat shading，三角形的面法向，逐个三角形确定颜色
Gouraud 着色： 根据每个顶点的颜色，在三角形中间用重心坐标插值，得到光滑的颜色过渡，在高光区域有三角形插值的痕迹。
Phong 着色： 单独计算每个像素的颜色，需要每个像素的法相，使用透视矫正的重心坐标插值，会有椭圆形的高光。


## 风格化渲染 non-photorealistic rendering NPR

Gooch着色： 冷暖色着色