# pmio

PMIO: 这类方法需要CPU设计一类特殊的指令, 比如x86的in指令和out指令. IO设备有一个与内存地址独立的地址空间, 称之为IO端口空间, 使用一个端口号来表示一个设备的内存或者寄存器. 通过IO端口选定设备后, CPU就可用in out指令对其进行读写。


## 端口管理

### 初始化

1. kvm__register_pio(kvm, start_port, size, handle, NULL)用于为虚拟机注册IO端口, 对应的IO陷出到Host的处理程序。
   1. 0000 - 001F： DMA1控制器
   2. 0020 - 003F： 8285A中断控制器1
   3. 0040 - 005F： PIT：可编程中断控制器（8253，254）
2. 针对pio、mmio，kvm保存mmio_tree和pio_tree的红黑树，注册的io处理程序通过起始地址保存为红黑树。


### 串口输出设备

在计算机一开始, 并没有图形显示器, 所有要输出的消息先一个字符一个字符的输出到通用异步收发传输器(UART), 再由UART输出到电传机(TTY)等终端设备, 8250就是一种UART设备. 内核中自带有UART设备的驱动。

后续随着计算机的发展, TTY设备已经被淘汰. 但是linux保留了这个名词, 使用tty泛指用于输出的终端设备. 控制台与终端的概念类似, 可以认为是用于输出内核消息的特殊终端. 我们在内核启动参数中可以看到, kvmtool默认把串口终端(ttyS0)作为控制台(console), 而没有使用VGA这样的视频设备

